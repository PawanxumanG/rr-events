<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>2048 ‚Äì RR Events App</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- GOOGLE ANALYTICS -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9JW1V42V83"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-9JW1V42V83', {
  page_title: '2048 Game',
  page_path: '/2048.html'
});
</script>

<style>
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
body{
    margin:0;
    font-family:'Segoe UI',Arial,sans-serif;
    background:#0f1117;
    color:#fff;
    text-align:center;
}

/* HEADER */
.header{
    background:linear-gradient(90deg,#ff6a00,#ff9800);
    padding:20px 12px;
}
.header h1{margin:0;font-size:28px;}
.header p{margin-top:6px;opacity:.9;}

/* SCORE */
.score-box{
    display:flex;
    justify-content:center;
    gap:14px;
    margin:16px 0;
}
.score{
    background:#161a22;
    padding:10px 16px;
    border-radius:10px;
    font-weight:600;
}

/* BOARD */
.board{
    width:300px;
    height:300px;
    margin:0 auto;
    background:#161a22;
    border-radius:14px;
    display:grid;
    grid-template-columns:repeat(4,1fr);
    gap:10px;
    padding:10px;
}

.cell{
    background:#0f1117;
    border-radius:10px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:22px;
    font-weight:bold;
}

/* TILE COLORS */
.tile-2{background:#eee4da;color:#000;}
.tile-4{background:#ede0c8;color:#000;}
.tile-8{background:#f2b179;}
.tile-16{background:#f59563;}
.tile-32{background:#f67c5f;}
.tile-64{background:#f65e3b;}
.tile-128{background:#edcf72;color:#000;}
.tile-256{background:#edcc61;color:#000;}
.tile-512{background:#edc850;}
.tile-1024{background:#edc53f;}
.tile-2048{background:#edc22e;}

.btn{
    width:80%;
    max-width:260px;
    margin-top:16px;
    padding:14px;
    border:none;
    border-radius:12px;
    font-size:16px;
    font-weight:600;
    cursor:pointer;
    color:#fff;
}
.btn-restart{background:linear-gradient(90deg,#6a11cb,#2575fc);}
.btn-back{background:#34495e;}
</style>
</head>

<body>

<div class="header">
    <h1>üî¢ 2048</h1>
    <p>Swipe ‚Ä¢ Combine ‚Ä¢ Win</p>
</div>

<div class="score-box">
    <div class="score">Score: <span id="score">0</span></div>
    <div class="score">Best: <span id="best">0</span></div>
</div>

<div class="board" id="board"></div>

<button class="btn btn-restart" onclick="restart()">üîÅ Restart</button>
<button class="btn btn-back" onclick="location.href='tictactoe.html'">‚¨Ö Back to Games</button>

<script>
let board,score=0;
const size=4;
const boardEl=document.getElementById("board");
const scoreEl=document.getElementById("score");
const bestEl=document.getElementById("best");

bestEl.innerText=localStorage.getItem("best2048")||0;

function init(){
    board=Array(size).fill().map(()=>Array(size).fill(0));
    score=0;
    addTile();addTile();
    update();
    gtag('event','2048_start');
}
init();

function addTile(){
    let empty=[];
    for(let r=0;r<size;r++)
        for(let c=0;c<size;c++)
            if(board[r][c]==0) empty.push({r,c});
    if(empty.length){
        let {r,c}=empty[Math.floor(Math.random()*empty.length)];
        board[r][c]=Math.random()<0.9?2:4;
    }
}

function update(){
    boardEl.innerHTML="";
    board.forEach(row=>{
        row.forEach(v=>{
            let d=document.createElement("div");
            d.className="cell"+(v?(" tile-"+v):"");
            d.innerText=v||"";
            boardEl.appendChild(d);
        });
    });
    scoreEl.innerText=score;
    if(score>bestEl.innerText){
        bestEl.innerText=score;
        localStorage.setItem("best2048",score);
    }
}

function slide(row){
    let arr=row.filter(v=>v);
    for(let i=0;i<arr.length-1;i++){
        if(arr[i]==arr[i+1]){
            arr[i]*=2;
            score+=arr[i];
            arr[i+1]=0;
        }
    }
    arr=arr.filter(v=>v);
    while(arr.length<size) arr.push(0);
    return arr;
}

function moveLeft(){
    let moved=false;
    for(let r=0;r<size;r++){
        let newRow=slide(board[r]);
        if(board[r].toString()!=newRow.toString()) moved=true;
        board[r]=newRow;
    }
    return moved;
}
function rotate(){
    board=board[0].map((_,i)=>board.map(r=>r[i]).reverse());
}
function move(dir){
    for(let i=0;i<dir;i++) rotate();
    let moved=moveLeft();
    for(let i=0;i<(4-dir)%4;i++) rotate();
    if(moved){addTile();update();gtag('event','2048_move');}
}

document.addEventListener("keydown",e=>{
    if(e.key=="ArrowLeft")move(0);
    if(e.key=="ArrowUp")move(1);
    if(e.key=="ArrowRight")move(2);
    if(e.key=="ArrowDown")move(3);
});

let sx,sy;
boardEl.addEventListener("touchstart",e=>{
    sx=e.touches[0].clientX;
    sy=e.touches[0].clientY;
});
boardEl.addEventListener("touchend",e=>{
    let dx=e.changedTouches[0].clientX-sx;
    let dy=e.changedTouches[0].clientY-sy;
    if(Math.abs(dx)>Math.abs(dy)){
        if(dx>30)move(2); else if(dx<-30)move(0);
    }else{
        if(dy>30)move(3); else if(dy<-30)move(1);
    }
});

function restart(){init();}
</script>

</body>
</html>