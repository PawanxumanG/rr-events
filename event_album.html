<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Event Album â€“ RR International College</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="style.css">

<script async src="https://www.googletagmanager.com/gtag/js?id=G-9JW1V42V83"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config','G-9JW1V42V83',{ page_path:'/event_album.html' });
</script>

<style>
.poster-box{
  border-radius:14px;
  padding:14px;
  margin-bottom:16px;
  text-align:center;
  box-shadow:0 0 18px rgba(0,0,0,.6);
}
.poster-box img{
  width:100%;
  border-radius:12px;
  margin-top:8px;
}
.download-btn{
  margin-top:12px;
  display:inline-block;
  padding:10px 18px;
  color:#fff;
  border-radius:999px;
  font-size:14px;
  font-weight:600;
  cursor:pointer;
}
.dialog-overlay{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.7);
  z-index:999;
  justify-content:center;
  align-items:center;
}
.dialog-box{
  background:#161a22;
  padding:22px;
  border-radius:16px;
  width:85%;
  max-width:320px;
  text-align:center;
}
.dialog-box input{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:none;
  margin-top:10px;
}
.error{color:#ff5252;font-size:13px;display:none;}
</style>
</head>

<body>

<div class="header">
  <h1>EVENT ALBUM</h1>
  <p>College Events & Memories</p>
</div>

<div class="container" id="albumContainer"></div>

<button onclick="history.back()" class="nav-btn">â¬… Back to Home</button>

<!-- PASSWORD POPUP -->
<div class="dialog-overlay" id="passwordDialog">
  <div class="dialog-box">
    <h3>ðŸ”’ Enter Password</h3>
    <input id="passwordInput" type="password">
    <p class="error" id="passwordError">Wrong password</p>
    <button onclick="verifyPassword()">Unlock</button>
  </div>
</div>

<script>
let ALBUM_DATA = null;
let pendingDownload = null;

fetch("album.json?t="+Date.now())
  .then(res=>res.json())
  .then(data=>{
    ALBUM_DATA = data;
    renderAlbum(data);
  });

function renderAlbum(data){
  const c = document.getElementById("albumContainer");
  data.events.forEach(event=>{
    const section = document.createElement("div");
    section.className="event";
    section.innerHTML = `<h2>${event.title}</h2><p>${event.description}</p>`;
    
    event.images.forEach(img=>{
      const box=document.createElement("div");
      box.className="poster-box";
      box.style.background=data.settings.theme.cardGradient;
      box.innerHTML=`
        <h3>${img.label}</h3>
        <img src="${img.src}">
        <div class="download-btn"
          style="background:${data.settings.theme.buttonGradient}"
          onclick="requestDownload('${img.src}','${img.downloadName}')">
          â¬‡ Download
        </div>
      `;
      section.appendChild(box);
    });

    c.appendChild(section);
  });
}

function requestDownload(url,name){
  if(sessionStorage.getItem("albumUnlocked")==="yes"){
    startDownload(url,name);
  }else{
    pendingDownload={url,name};
    document.getElementById("passwordDialog").style.display="flex";
  }
}

function verifyPassword(){
  const pass=document.getElementById("passwordInput").value;
  if(pass===ALBUM_DATA.settings.downloadPassword){
    sessionStorage.setItem("albumUnlocked","yes");
    document.getElementById("passwordDialog").style.display="none";
    document.getElementById("passwordError").style.display="none";
    startDownload(pendingDownload.url,pendingDownload.name);
  }else{
    document.getElementById("passwordError").style.display="block";
  }
}

function startDownload(url,name){
  const a=document.createElement("a");
  a.href=url;
  a.download=name;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);

  gtag('event','album_download',{event_label:name});
}
</script>

</body>
</html>